<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>排序算法动画演示</title>
    <style>
        #main {
            display: inline-block;
        }

        .col-wapper {
            float: left;
            font-size: xx-small;
            color: red;
            text-align: center;
            width: 15px;
            margin: 0px 5px 0px 5px;
        }

        .col {
            background-color: orange;
            border-radius: 10px 10px 0px 0px;
        }
    </style>
    <script>
        let array, middleArray;
        window.onload = function () {
            createRandomArray()
        }

        // 生成数组数据并创建柱状图形
        function createRandomArray() {
            let size = +document.getElementById('size').value
            let rangeL = +document.getElementById('rangeL').value
            let rangeR = +document.getElementById('rangeR').value
            array = generateRandomArray(size, rangeL, rangeR)
            createColumnArray(array)
        }

        // 生成数组数据
        function generateRandomArray(size, rangeL, rangeR) {
            const array = []
            for (let i = 0; i < size; i++) {
                array[i] = Math.floor((Math.random() * (rangeR - rangeL + 1))) + rangeL
            }
            return array;
        }

        // 创建柱状图形
        function createColumnArray(array) {
            let main = document.getElementById('main')
            main.innerHTML = ''
            let rangeR = +document.getElementById('rangeR').value
            let multiple = 350 / rangeR
            array.forEach((value, index) => {
                let colWapper = document.createElement('div');
                colWapper.id = 'col-wapper-' + index
                colWapper.className = 'col-wapper'
                colWapper.style.paddingTop = ((rangeR - value) * multiple) + 'px'
                main.appendChild(colWapper)

                let valueSpan = document.createElement('span')
                valueSpan.innerText = value
                colWapper.appendChild(valueSpan)

                let col = document.createElement('div');
                col.id = 'col-' + index
                col.className = "col";
                col.style.height = (value * multiple) + 'px'
                colWapper.appendChild(col)
            })
        }

        function sortSuccess(array) {
            let index = 0
            setInterval(function () {
                if (index < array.length) {
                    let colWapper = document.getElementById('col-' + index);
                    colWapper.style.backgroundColor = 'green'
                    index++
                }
            }, 50)
        }

        // 排序交换元素
        function swap(array, i, j) {
            let temp = array[i]
            array[i] = array[j]
            array[j] = temp
            // 记录一下临时数据
            middleArray.push([...array])
        }

        // 具体的排序方法
        function bubble(array) {
            for (let i = 0; i < array.length - 1; i++) {
                for (let j = 0; j < array.length - 1; j++) {
                    if (array[j + 1] < array[j]) {
                        swap(array, j, j + 1)
                    }
                }
            }
        }

        function select(array) {
            for (let i = 0; i < array.length - 1; i++) {
                let min = i
                for (let j = i + 1; j < array.length; j++) {
                    if (array[j] < array[min]) {
                        min = j
                    }
                }
                swap(array, i, min);
            }
        }

        function insert(array) {
            for (let i = 1; i < array.length; i++) {
                let insertValue = array[i]
                let j = 0
                for (j = i; j > 0 && array[j - 1] > insertValue; j--) {
                    swap(array, j, j - 1)
                }
            }
        }

        function shell(array) {
            let h = 1
            while ((h * 3 + 1) < array.length) {
                h = h * 3 + 1
            }
            while (h > 0) {
                for (let i = h; i < array.length; i++) {
                    let insertValue = array[i];
                    let j = i
                    for (j = i; j > h - 1 && array[j - h] > insertValue; j = j - h) {
                        swap(array, j, j - h)
                    }
                }
                h = (h - 1) / 3
            }
        }

        function quick(array) {
            quickSort(array, 0, array.length - 1)
        }

        function quickSort(array, startIndex, endIndex) {
            if (startIndex >= endIndex) {
                return;
            }
            let pivotIndex = partition(array, startIndex, endIndex)
            quickSort(array, startIndex, pivotIndex - 1)
            quickSort(array, pivotIndex + 1, endIndex)
        }

        function partition(array, startIndex, endIndex) {
            let pivot = array[startIndex];
            let left = startIndex;
            let right = endIndex;
            while (left != right) {
                while (left < right && array[right] > pivot) {
                    right--
                }
                while (left < right && array[left] <= pivot) {
                    left++
                }
                if (left < right) {
                    swap(array, left, right)
                }
            }
            swap(array, startIndex, left)
            return left
        }

        function sort() {
            const funcSelect = document.getElementById('func')
            let func
            try {
                func = eval(funcSelect.value);
            } catch (e) {
                let funcName = funcSelect.options[funcSelect.selectedIndex].text
                alert('【' + funcName + '】未实现，请实现' + '【' + funcName + '】方法！')
                return
            }
            middleArray = []
            new func(array)
            let middleStep = 0
            setInterval(function () {
                if (middleStep < middleArray.length) {
                    createColumnArray(middleArray[middleStep++])
                    if (middleStep == middleArray.length) {
                        sortSuccess(array)
                    }
                }
            }, 50)
        }


    </script>
</head>

<body>
    <div style="text-align: center">
        <div id="func-name"></div>
        <div id="main">
        </div>
        <div>
            <select id="func">
                <option value="bubble">冒泡排序</option>
                <option value="select">选择排序</option>
                <option value="insert">插入排序</option>
                <option value="shell">希尔排序</option>
                <option value="quick">快速排序</option>
            </select>
            <input type="button" value="开始排序" onclick="sort()" />
            <input type="button" value="重新生成随机数组" onclick="createRandomArray()" />
            <!-- <input type="button" value="重新生成近似有序数组" onclick="createAlmostOrderlyArray()"/> -->
        </div>
        <div>
            元素个数：<input type="text" value="50" id="size" name="size" style="width: 30px;" />
            元素范围：<input type="text" value="0" id="rangeL" name="rangeL" style="width: 50px;" />
            <input type="text" value="300" id="rangeR" name="rangeR" style="width: 50px;" />
        </div>
    </div>
</body>

</html>